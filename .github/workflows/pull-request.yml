# ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ç”¨ã®PRã‚’ä½œæˆã™ã‚‹
name: Create VersionUp PR
on: 
  workflow_dispatch:
    inputs:
      release-note:
        required: true
        description: 'ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’è¨˜å…¥ã—ã¦ãã ã•ã„'
      version-up:
        type: boolean
        description: 'é–‹ç™ºãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã¾ã™ã‹ï¼Ÿ'
        default: true
      environment:
        type: environment
jobs:
  create:
    name: Create PR
    runs-on: ubuntu-latest
    environment: ${{github.event.inputs.environment}}
    env:
      GH_TOKEN: ${{secrets.GITHUB_TOKEN}}
    steps:
    - uses: actions/checkout@v3
    - name: Update Version
      id: update
      run: |
          read version dev_version build_number <<< `cat pubspec.yaml | grep ^version | sed -e "s/\(^version: \)\(.*\.\)\([0-9]*\)+\([0-9]*\)/\2 \3 \4/g"`
          echo old version: $version$dev_version+$build_number
          if ${{github.event.inputs.version-up}}; then
            dev_version=$((dev_version+1))
          fi
          build_number=$((build_number+1))
          new_version=$version$dev_version+$build_number
          echo âœ¨ new version: $new_version
          sed -i -e "s/\(^version: \)\(.*$\)/\1$new_version/g" pubspec.yaml
          echo "::set-output name=new_version::$new_version"
    - name: Create Pull Request
      id: create-pr
      uses: peter-evans/create-pull-request@v4
      with:
        branch: version/update-${{github.event.inputs.environment}}
        title: 'ğŸ”– :Update version to ${{steps.update.outputs.new_version}} for Deployment ${{github.event.inputs.environment}}'
        body: ${{github.event.inputs.release-note}}
        labels: ${{github.event.inputs.environment}}
