on: push
name: Create PR
jobs:
  create:
    name: Create PR
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
    - uses: actions/checkout@v3
    - name: Checkout Branch
      run: git checkout -b version/update
    - name: Update Version
      id: update
      run: |
          read version dev_version build_number <<< `cat pubspec.yaml | grep ^version | sed -e "s/\(^version: \)\(.*\.\)\([0-9]*\)+\([0-9]*\)/\2 \3 \4/g"`
          echo old version: $version$dev_version+$build_number
          dev_version=$((dev_version+1))
          build_number=$((build_number+1))
          new_version=$version$dev_version+$build_number
          echo âœ¨ new version: $new_version
          sed -i -e "s/\(^version: \)\(.*$\)/\1$new_version/g" pubspec.yaml
          echo "::set-output name=new_version::$new_version"
    - name: Commit & Push
      run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add .
          git commit -m "Update version to ${{steps.update.outputs.new_version}}"
          git push origin version/update
    - name: Create Pull Request
      run: gh pr create -B main -t "ðŸ”– Update version to ${{steps.update.outputs.new_version}}" -b "ãƒ†ã‚¹ãƒˆ"
